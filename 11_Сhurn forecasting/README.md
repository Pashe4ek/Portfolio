# Прогнозирование оттока клиентов

## Описание проекта

Оператор связи «Ниединогоразрыва.ком» хочет научиться прогнозировать отток клиентов. Если выяснится, что пользователь планирует уйти, ему будут предложены промокоды и специальные условия. Команда оператора собрала персональные данные о некоторых клиентах, информацию об их тарифах и договорах.

## Описание услуг

Оператор предоставляет два основных типа услуг: \
Стационарную телефонную связь. Возможно подключение телефонного аппарата к нескольким линиям одновременно. \
Интернет. Подключение может быть двух типов: через телефонную линию (DSL, от англ. digital subscriber line, «цифровая абонентская линия») или оптоволоконный кабель (Fiber optic). \
Также доступны такие услуги: \
Интернет-безопасность: антивирус (DeviceProtection) и блокировка небезопасных сайтов (OnlineSecurity); \
Выделенная линия технической поддержки (TechSupport); \
Облачное хранилище файлов для резервного копирования данных (OnlineBackup); \
Стриминговое телевидение (StreamingTV) и каталог фильмов (StreamingMovies). \
За услуги клиенты могут платить каждый месяц или заключить договор на 1–2 года. Доступны различные способы расчёта и возможность получения электронного чека. 

## Описание данных

Данные состоят из файлов, полученных из разных источников: \
contract_new.csv — информация о договоре; \
personal_new.csv — персональные данные клиента; \
internet_new.csv — информация об интернет-услугах; \
phone_new.csv — информация об услугах телефонии. \
Во всех файлах столбец customerID содержит код клиента. \
Информация о договорах актуальна на 1 февраля 2020. 

## Задача проекта

Задачей данной работы является построение модели по оттоку клиентов на основе предоставленных данных командой оператора. \
Основная метрика: AUC-ROC. Она должна быть не менее 0.85 \
Дополнительная метрика: Accuracy.

## Навыки и инструменты

* pandas
* seaborn
* numpy
* time
* matplotlib.pyplot
* phik
* imblearn.over_sampling.SMOTE
* imblearn.pipeline.Pipeline
* sklearn.model_selection.train_test_split
* sklearn.model_selection.cross_val_score
* sklearn.model_selection.GridSearchCV
* sklearn.linear_model.LogisticRegression
* sklearn.ensemble.RandomForestClassifier
* sklearn.metrics.roc_auc_score
* sklearn.metrics.accuracy_score
* sklearn.preprocessing.StandardScaler
* sklearn.preprocessing.OneHotEncoder
* sklearn.compose.make_column_transformer
* sklearn.metrics
* catboost.CatBoostClassifier


## Заключение (Отчет)

Оператор связи «Ниединогоразрыва.ком» поставил задачу построения модели по оттоку клиентов на основе данных предоставленных командой оператора. Необходимо было получить основную метрику: AUC-ROC не менее 0.85, а также оценить дополнительную метрику: Accuracy. \
После изучения данных были сделаны следующие действия: \
Выделен целевой признак из столбца "Enddate"; \
Создан новый признак "продолжительность пользования услугами оператора" при помощи столбцов "Begindate" и "Enddate"; \
Подготовлены признаки для анализа. \
Явные дубликаты были удалены. \
Аномали не удалялись \
Пропуски были заполнены значением "No", т.е. клиент не пользуется данными услугами \
Данные были проверены на корреляцию для оценки признаков, после оценки было принято решение об удалении признака 'gender', т.к. он имеет слабую корреляцию со всеми признаками \
По результатам иследовательского анализа данных были сделаны следующие гипотезы: \
Клиенты с способом оплаты каждый год или каждые 2 года, чаще уходят по сравнению с клиентами которые имеют способ оплаты каждый месяц.
Клиенты без супруга(и) реже уходят. \
У клиентов которые ушли, чаще были подключены разные дополнительные услуги. \
Ушедшие клиенты часто платили высокую Ежемесячную плату \
В нашей выборке наибольший отток клиентов произошол после 3-х лет пользования. \

Для обучения моделей мы использовали признаки на основе предоставленных данных:
​
* Type – тип оплаты: ежемесячный, годовой и тд
* PaperlessBilling – безналичный расчет 
* PaymentMethod – способ оплаты 
* MonthlyCharges – ежемесячные траты на услуги 
* TotalCharges – всего потрачено денег на услуги 
* Senior Citizen – наличие пенсионного статуса по возрасту 
* Partner – наличие супруга(и) 
* Dependents – наличие иждивенцев 
* InternetService - Тип подключения 
* OnlineSecurity - Блокировка небезопасных сайтов
* OnlineBackup - Облачное хранилище файлов для резервного копирования данных
* DeviceProtection  - Антивирус
* TechSupport - Выделенная линия технической поддержки
* StreamingTV - Стриминговое телевидение
* StreamingMovies - Каталог фильмов
* MultipleLines – наличие возможности ведения параллельных линий во время звонка
​
А также созданный признак:
​
* client_time - продолжительность пользования услугами оператора в днях
​
При разделении на тестовую и обучающую выборку, размер тестовой выборки составил 0.25, была задана пропорция классов по целевой метрике. \
Также был зафиксирован генератор случайных чисел датой начала проработки проекта - Random_state = 240423 \
Для решения задачи классификации мы анализровали 3 модели: \
* Логистическая регрессия
* Cлучайный лес
* Градиентный бустинг - CatBoost
Для всех моделей мы использовали: \
Преобразование категориальных признаков при помощи OneHotEncoder \
Cтандартизация вещественных признаков при помощи StandardScaler \
Балансировка таргета методом SMOTE \
Лучшей моделью оказалась модель - градиентного бустинга (CatBoost) со следующими параметрами: \
depth (глубина дерева) - 4 \
l2_leaf_reg (коэффициент регуляризации L2): 1 \
learning_rate (скорость обучения): 0.1 \
Все остальные параметры были использованы по умолчанию \
В результате были получены: \
ROC-AUC лучшей модели на кросс-валидации - 0.9151, на тесте 0.9163 \
Доля правельных ответов лучшей модели на кросс-валидации - 0.9044, на тесте 0.9233 \
Дополнительно был проведен анализ важности признаков для лучшей модели, выделил топ 10 с указанием важности: \
'client_time' (продолжительность пользования услугами оператора в днях) - 27.58 % \
'partner' (наличие супруга(и)) - 6.70 % \
'paperlessbilling' (безналичный расчет) - 5.91% \
'onlinebackup' (облачное хранилище файлов для резервного копирования данных) - 5.30 % \
'multiplelines' (наличие возможности ведения параллельных линий во время звонка) - 4.96% \
'deviceprotection' (наличие антивируса) - 4.66% \
'seniorcitizen' (наличие пенсионного статуса по возрасту) - 4.25% \
'dependents' (наличие иждивенцев) - 4.24% \
'onlinesecurity' (наличие блокировки небезопасных сайтов) - 3.99% \
'type_One year' (тип оплаты - годовой) - 3.99% 